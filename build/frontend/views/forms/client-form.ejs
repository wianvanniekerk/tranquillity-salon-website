<%- include('../partials/header', { title: 'Client Skin Analysis Form' }) %>

<div class="bg-gradient-to-br from-teal-50 to-teal-100 min-h-screen py-12">
  <div class="container mx-auto px-4 lg:px-8 max-w-4xl">
    <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
      <div class="px-6 py-8 bg-gradient-to-r from-teal-400 to-teal-500 text-white">
        <h1 class="text-4xl font-extrabold text-center">Client Skin Analysis Form</h1>
        <p class="mt-2 text-center text-teal-50">Please fill out all fields for a comprehensive analysis</p>
      </div>
      <div class="p-8 md:p-12">
        <form id="skinAnalysisForm" action="/forms/submit" method="POST" class="space-y-12">
          <input type="hidden" name="token" value="<%= token %>">
          
          <section>
            <h2 class="text-2xl font-bold text-teal-500 mb-4">General Information</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
              <div class="space-y-4">
                <label for="phoneNumber" class="block text-sm font-semibold text-gray-800">Phone Number</label>
                <input id="phoneNumber" name="phoneNumber" type="tel" required pattern="[0-9]{10}" maxlength="10" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 transition duration-150 ease-in-out bg-gray-200 p-2 text-gray-800">
                <p id="phoneNumberError" class="text-red-500 text-xs mt-1 hidden">Please enter a valid 10-digit phone number.</p>
              </div>

              <div class="space-y-4">
                <label for="occupation" class="block text-sm font-semibold text-gray-800">Occupation</label>
                <input id="occupation" name="occupation" type="text" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 transition duration-150 ease-in-out bg-gray-200 p-2 text-gray-800">
              </div> 
          
              <div class="space-y-4">
                <label for="address" class="block text-sm font-semibold text-gray-800">Address</label>
                <input id="address" name="address" type="text" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 transition duration-150 ease-in-out bg-gray-200 p-2 text-gray-800">
              </div>
          
              <div class="space-y-4">
                <label for="area" class="block text-sm font-semibold text-gray-800">Area</label>
                <input id="area" name="area" type="text" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 transition duration-150 ease-in-out bg-gray-200 p-2 text-gray-800">
              </div>
          
              <div class="space-y-4">
                <label for="postalCode" class="block text-sm font-semibold text-gray-800">Postal Code</label>
                <input id="postalCode" name="postalCode" type="text" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 transition duration-150 ease-in-out bg-gray-200 p-2 text-gray-800">
              </div>
          
              <div class="space-y-4">
                <label for="dateOfBirth" class="block text-sm font-semibold text-gray-800">Date of Birth</label>
                <input id="dateOfBirth" name="dateOfBirth" type="date" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 transition duration-150 ease-in-out bg-gray-200 p-2 text-gray-800">
              </div>
          
              <div class="space-y-4">
                <label for="marketingConsent" class="block text-sm font-semibold text-gray-800">Marketing Consent</label>
                <label class="inline-flex items-center">
                  <input type="radio" name="marketingConsent" value="1" required class="form-radio text-teal-500 focus:ring-teal-400">
                  <span class="ml-2 text-gray-800">Yes</span>
                </label>
                <label class="inline-flex items-center">
                  <input type="radio" name="marketingConsent" value="0" required class="form-radio text-teal-500 focus:ring-teal-400">
                  <span class="ml-2 text-gray-800">No</span>
                </label>
              </div>
          
              <div class="space-y-4">
                <label for="idNumber" class="block text-sm font-semibold text-gray-800">ID Number</label>
                <input id="idNumber" name="idNumber" type="text" required pattern="[0-9]{13}" maxlength="13" autocomplete="off" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 transition duration-150 ease-in-out bg-gray-200 p-2 text-gray-800">
                <p id="idNumberError" class="text-red-500 text-xs mt-1 hidden">Please enter a valid 13-digit ID number.</p>
              </div>
          
              <div class="space-y-4">
                <label for="password" class="block text-sm font-semibold text-gray-800">Password</label>
                <input id="password" name="password" type="password" required minlength="8" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 transition duration-150 ease-in-out bg-gray-200 p-2 text-gray-800">
                <p id="passwordError" class="text-red-500 text-xs mt-1 hidden">Password must be at least 8 characters long.</p>
              </div>
              
              <div class="space-y-4">
                <label for="retypePassword" class="block text-sm font-semibold text-gray-800">Retype Password</label>
                <input id="retypePassword" name="retypePassword" type="password" required minlength="8" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 transition duration-150 ease-in-out bg-gray-200 p-2 text-gray-800">
                <p id="retypePasswordError" class="text-red-500 text-xs mt-1 hidden">Passwords do not match.</p>
              </div>
            </div>
          </section>          

          <section>
            <h2 class="text-2xl font-bold text-teal-500 mb-4">Skin Information</h2>
            <div class="space-y-4">
              <label for="current_skin_care_range" class="block text-sm font-semibold text-gray-800">Current Skincare Range</label>
              <textarea id="current_skin_care_range" name="current_skin_care_range" rows="3" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 transition duration-150 ease-in-out bg-gray-200 p-2 text-gray-800"></textarea>
            </div>
          </section>

          <section>
            <h2 class="text-2xl font-bold text-teal-500 mb-4">Medical History</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
              <% const booleanFields = [
                { field: 'hormonal_imbalance', label: 'Hormonal Imbalance' },
                { field: 'pregnant', label: 'Are you Pregnant?' },
                { field: 'breastfeeding', label: 'Breastfeeding' },
                { field: 'smoker', label: 'Smoker' },
                { field: 'skin_cancer', label: 'Skin Cancer' },
                { field: 'ipl_laser_2weeks', label: 'IPL/Laser in last 2 weeks' },
                { field: 'skin_resurfacing_chemical_peels_2weeks', label: 'Skin Resurfacing/Chemical Peels in last 2 weeks' },
                { field: 'botox_fillers_2weeks', label: 'Botox/Fillers in last 2 weeks' },
                { field: 'waxing_electrolysis_3days', label: 'Waxing/Electrolysis in last 3 days' }
              ]; %>
              
              <% booleanFields.forEach(item => { %>
                <div class="space-y-2">
                  <label class="block text-sm font-semibold text-gray-800"><%= item.label %></label>
                  <div class="mt-2 space-x-6">
                    <label class="inline-flex items-center">
                      <input type="radio" name="<%= item.field %>" value="1" required class="form-radio text-teal-500 focus:ring-teal-400">
                      <span class="ml-2 text-gray-800">Yes</span>
                    </label>
                    <label class="inline-flex items-center">
                      <input type="radio" name="<%= item.field %>" value="0" required class="form-radio text-teal-500 focus:ring-teal-400">
                      <span class="ml-2 text-gray-800">No</span>
                    </label>
                  </div>
                </div>
              <% }); %>
            </div>

            <div class="mt-8 space-y-4">
              <label for="medical_conditions_surgery_past_year" class="block text-sm font-semibold text-gray-800">Medical Conditions/Surgery in the past year</label>
              <textarea id="medical_conditions_surgery_past_year" name="medical_conditions_surgery_past_year" rows="3" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 transition duration-150 ease-in-out bg-gray-200 p-2 text-gray-800"></textarea>
            </div>
          </section>

          <section>
            <h2 class="text-2xl font-bold text-teal-500 mb-4">Current Medication Usage</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
              <% const medicationFields = [
                { field: 'tretinoin_medication', label: 'Tretinoin Medication' },
                { field: 'accutane_medication', label: 'Accutane Medication' },
                { field: 'cortisone_medication', label: 'Cortisone Medication' },
                { field: 'thyroid_medication', label: 'Thyroid Medication' },
                { field: 'blood_pressure_medication', label: 'Blood Pressure Medication' },
                { field: 'hormonal_contraceptives', label: 'Hormonal Contraceptives' }
              ]; %>
              
              <% medicationFields.forEach(item => { %>
                <div class="space-y-2">
                  <label class="block text-sm font-semibold text-gray-800"><%= item.label %></label>
                  <div class="mt-2 space-x-6">
                    <label class="inline-flex items-center">
                      <input type="radio" name="<%= item.field %>" value="1" required class="form-radio text-teal-500 focus:ring-teal-400">
                      <span class="ml-2 text-gray-800">Yes</span>
                    </label>
                    <label class="inline-flex items-center">
                      <input type="radio" name="<%= item.field %>" value="0" required class="form-radio text-teal-500 focus:ring-teal-400">
                      <span class="ml-2 text-gray-800">No</span>
                    </label>
                  </div>
                </div>
              <% }); %>
            </div>

            <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-8">
              <div class="space-y-4">
                <label for="other_medications" class="block text-sm font-semibold text-gray-800">Other Medications</label>
                <textarea id="other_medications" name="other_medications" rows="3" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 transition duration-150 ease-in-out bg-gray-200 p-2 text-gray-800"></textarea>
              </div>

              <div class="space-y-4">
                <label for="allergies" class="block text-sm font-semibold text-gray-800">Allergies</label>
                <textarea id="allergies" name="allergies" rows="3" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 transition duration-150 ease-in-out bg-gray-200 p-2 text-gray-800"></textarea>
              </div>
            </div>
          </section>

          <div class="flex justify-end">
            <button id="submitButton" type="submit" class="inline-flex items-center px-6 py-3 bg-teal-500 text-white font-semibold text-lg rounded-lg shadow-md hover:bg-teal-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition duration-150 ease-in-out">
              Submit Form
            </button>
            <div id="loadingIndicator" class="hidden mt-2 text-center">
              <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-teal-500"></div>
              <span class="ml-2 text-teal-500">Submitting...</span>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('skinAnalysisForm');
    const inputs = form.querySelectorAll('input[required], textarea[required]');
    const submitButton = document.getElementById('submitButton');
    const loadingIndicator = document.getElementById('loadingIndicator');

    function validateInput(input) {
      let isValid = true;

      if (input.type === 'radio') {
        const radioGroup = form.querySelectorAll(`input[name="${input.name}"]`);
        const checked = Array.from(radioGroup).some(radio => radio.checked);
        const label = input.closest('div').querySelector('label');
        if (label) {
          label.classList.toggle('text-red-500', !checked);
        }
        isValid = checked;
      } else {
        if (!input.value.trim()) {
          isValid = false;
        } else {
          switch (input.id) {
            case 'phoneNumber':
              isValid = /^\d{10}$/.test(input.value);
              break;
            case 'idNumber':
              isValid = /^\d{13}$/.test(input.value);
              break;
            case 'password':
              isValid = input.value.length >= 8;
              break;
            case 'retypePassword':
              const password = form.querySelector('#password');
              isValid = input.value === password.value;
              break;
          }
        }

        input.classList.toggle('border-red-500', !isValid);
        const errorElement = document.getElementById(`${input.id}Error`);
        if (errorElement) {
          errorElement.classList.toggle('hidden', isValid);
        }
      }

      return isValid;
    }

    inputs.forEach(input => {
      input.addEventListener('input', function() {
        validateInput(this);
      });

      input.addEventListener('blur', function() {
        validateInput(this);
      });
    });

    form.addEventListener('submit', function(event) {
      let isValid = true;

      inputs.forEach(input => {
        if (!validateInput(input)) {
          isValid = false;
        }
      });

      if (!isValid) {
        event.preventDefault();
        alert('Please correct the errors in the form before submitting.');
      } else {
        loadingIndicator.classList.remove('hidden');
        submitButton.disabled = true;
      }
    });
  });
</script>



<%- include('../partials/footer') %>
